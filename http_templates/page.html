<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8" />
<title>%%NICKNAME%% &ndash; Chatbox</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style type="text/css">
body { font-family: sans-serif; }
.textinput, button { box-sizing: border-box; border: 1px solid #eee; border-radius: 15px; height: 30px; padding-left: 10px; padding-right: 10px; margin: 0px; }
#messageinput, #sendbutton { width: 100%; }
#messageinput { background-color: #fff; }
button { background-color: #eee; }
.sendername a:link, .sendername a:visited, .editlink a:link, .editlink a:visited { text-decoration: none; color: black; }
.sendername a:link .myself, .sendername a:visited .myself, .editlink a:link .myself, .editlink a:visited .myself { color: blue; }
.icon, .smiley { max-height: 4em; }
.spoiler { background-color: black; color: black; }
.jsclick { cursor: pointer; }
</style>
<script type="text/javascript">
function messagesFetched() {
  document.getElementById('messages').innerHTML = this.responseText;
  MathJax.Hub.Queue(["Typeset",MathJax.Hub], [window.setTimeout, 'fetchMessages()', 3000]);
}

function smiliesFetched() {
  document.getElementById('smilies').innerHTML = this.responseText;
}

function hideSmilies() {
  document.getElementById('smilies').innerHTML = '<button type="button" onclick="fetchSmilies()">Smile!</button>';
}

function smileyClicked(smiley) {
  var re = /(^|\s)$/;
  var val = document.getElementById('messageinput').value;
  if (!re.test(val)) {
    // message doesn't end with whitespace; add a space
    val += ' ';
  }
  val += smiley;
  document.getElementById('messageinput').value = val;
}

function fetchMessages() {
  var req = new XMLHttpRequest();
  req.onload = messagesFetched;
  req.open('GET', '/messages', true);
  req.send();
}

function fetchSmilies() {
  var req = new XMLHttpRequest();
  req.onload = smiliesFetched;
  req.open('GET', '/smilies', true);
  req.send();
}

function sendQuick(msg) {
  var req = new XMLHttpRequest();
  var body = "message=" + encodeURIComponent(msg);
  req.open('POST', '/postmessage', true);
  req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  req.setRequestHeader('Content-Length', body.length);
  req.setRequestHeader('Connection', 'close');
  req.send(body);
}

window.setTimeout('fetchMessages()', 500);
window.setTimeout("document.getElementById('messageinput').focus()", 600);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    jax: ["input/TeX", "output/HTML-CSS"],
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js" type="text/javascript"></script>
</head>
<body>
<form action="/postmessage" method="POST">
<p><input type="text" name="message" id="messageinput" class="textinput" /></p>
<p><button type="submit" id="sendbutton">Send</button></p>
</form>
<p><span id="smilies"><button type="button" onclick="fetchSmilies()">Smile!</button></span> %%QUICKMESSAGES%%</p>
<div id="messages">
Fetching...
</div>
</body>
</html>
